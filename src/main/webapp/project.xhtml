<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="layout/core.xhtml">

	<ui:define name="title">
		<h:outputText value="#{messages.project}" />
	</ui:define>

	<rich:panel header="#{messages.project}">
		<h:panelGrid columns="3" columnClasses="caption,value,help">
			<h:outputText value="#{messages.project_name}" />
			<h:inputText value="#{projectDetail.instance.name}" id="project_name" />
			<h:outputText value="#{messages.project_name_help}" />

			<h:outputText value="#{messages.project_description}" />
			<h:inputTextarea value="#{projectDetail.instance.description}"
				id="project_description" rows="2" cols="40" />
			<h:outputText value="#{messages.project_description_help}" />

			<h:outputText value="#{messages.project_vcsHost}" />
			<h:selectOneMenu value="#{projectDetail.instance.vcsHost}"
				id="project_vcsHost" converter="vcshostConverter">
				<f:selectItems value="#{selectItemBean.allVcshostSelectItems}" />
				<f:ajax event="change" render="server_uri" />
			</h:selectOneMenu>
			<h:outputText value="#{messages.project_vcsHost_help}" />
			<h:outputText value="" />
			<h:outputText id="server_uri"
				value="#{projectDetail.instance.vcsHost.uri}" />
			<h:outputText value="" />

			<h:outputText value="#{messages.project_vcsPath}" />
			<h:inputText value="#{projectDetail.instance.vcsPath}"
				id="project_vcsPath" disabled="#{projectDetail.managed}" />
			<h:outputText value="#{messages.project_vcsPath_help}" />

			<h:outputText value="#{messages.project_tagTransformer}" />
			<h:selectOneMenu value="#{projectDetail.instance.tagTransformer}"
				id="project_tagTransformer" converter="tagtransformerConverter">
				<f:selectItem itemValue="#{null}"
					itemLabel="#{messages.tagtransformer_none}" />
				<f:selectItems
					value="#{selectItemBean.allTagTransformerSelectItems}" />
			</h:selectOneMenu>
			<h:outputText value="#{messages.project_tagTransformer_help}" />

			<h:outputText value="#{messages.project_configuredServers}" />
			<h:selectManyMenu value="#{projectDetail.instance.configuredServers}"
				id="project_configuredServers" converter="serverConverter"
				style="height: 100px;">
				<f:selectItems value="#{selectItemBean.allServerSelectItems}" />
				<!-- JSF 2 creates a clone of a completely valid PersistentBag making it lose it's entitymanager, see http://stackoverflow.com/questions/5610908/selectmanycheckbox-lazyinitializationexception-on-process-validation -->
				<f:attribute name="collectionType" value="java.util.ArrayList" />
			</h:selectManyMenu>
			<h:outputText value="#{messages.project_configuredServers_help}" />
		</h:panelGrid>
	</rich:panel>

	<rich:tabPanel switchType="client">
		<rich:tab
			header="#{messages.actionCopies} (#{projectDetail.instance.actionCopies.size()})">
			<ui:repeat var="actionCopy"
				value="#{projectDetail.instance.actionCopies}">

				<rich:panel header="#{messages.actionCopy}">
					<h:commandLink
						action="#{projectDetail.deleteActionCopy(actionCopy)}"
						class="deletionlink" title="#{messages.actionCopy_delete}">
						<h:graphicImage value="/images/elementary/edit-delete.png" />
					</h:commandLink>

					<h:panelGrid columns="3" columnClasses="caption,value,help"
						style="padding-bottom: 15px;">
						<h:outputText value="#{messages.actionCopy_targetPath}" />
						<h:inputText value="#{actionCopy.targetPath}"
							id="actionCopy_targetPath" />
						<h:outputText value="#{messages.actionCopy_targetPath_help}" />

						<h:outputText value="#{messages.actionCopy_targetFilename}" />
						<h:inputText value="#{actionCopy.targetFilename}"
							id="actionCopy_targetFilename" />
						<h:outputText value="#{messages.actionCopy_targetFilename_help}" />
					</h:panelGrid>

					<h:commandButton
						action="#{projectDetail.chooseCopyMavenArtifact(actionCopy)}"
						value="#{messages.add_mavenartifact}"
						rendered="#{empty actionCopy.mavenArtifact and empty actionCopy.spacerUrl}" />
					<h:commandButton
						action="#{projectDetail.chooseCopySpacerUrl(actionCopy)}"
						value="#{messages.add_spacerurl}"
						rendered="#{empty actionCopy.mavenArtifact and empty actionCopy.spacerUrl}" />

					<h:commandLink
						action="#{projectDetail.deleteMavenArtifact(actionCopy.mavenArtifact)}"
						class="deletionlink"
						rendered="#{not empty actionCopy.mavenArtifact}"
						title="#{messages.mavenArtifact_delete}">
						<h:graphicImage value="/images/elementary/edit-delete.png" />
					</h:commandLink>
					<h:commandLink
						action="#{projectDetail.deleteSpacerUrl(actionCopy.spacerUrl)}"
						class="deletionlink" rendered="#{not empty actionCopy.spacerUrl}"
						title="#{messages.spacerUrl_delete}">
						<h:graphicImage value="/images/elementary/edit-delete.png" />
					</h:commandLink>
					<ui:include src="/layout/mavenArtifact_or_spacerUrl.xhtml">
						<ui:param name="actionEntity" value="#{actionCopy}" />
						<ui:param name="idPrefix" value="actionCopy_" />
					</ui:include>

				</rich:panel>
			</ui:repeat>
			<h:commandButton action="#{projectDetail.chooseCopy}"
				value="#{messages.actionCopy_add}" />
		</rich:tab>
		<rich:tab
			header="#{messages.actionExtractions} (#{projectDetail.instance.actionExtractions.size()})">
			<ui:repeat var="actionExtraction"
				value="#{projectDetail.instance.actionExtractions}">

				<rich:panel header="#{messages.actionExtraction}">
					<h:commandLink
						action="#{projectDetail.deleteActionExtraction(actionExtraction)}"
						class="deletionlink" title="#{messages.actionExtraction_delete}">
						<h:graphicImage value="/images/elementary/edit-delete.png" />
					</h:commandLink>

					<ui:repeat value="#{actionExtraction.extractions}" var="extraction">
						<h:commandLink
							action="#{projectDetail.deleteExtraction(extraction)}"
							class="deletionlink"
							title="#{messages.actionExtraction_extraction_delete}">
							<h:graphicImage value="/images/elementary/edit-delete.png" />
						</h:commandLink>
						<h:panelGrid columns="3" columnClasses="caption,value,help">
							<h:outputText value="#{messages.actionExtraction_source}" />
							<h:inputText value="#{extraction.source}" />
							<h:outputText value="#{messages.actionExtraction_source_help}" />
							<h:outputText value="#{messages.actionExtraction_destination}" />
							<h:inputText value="#{extraction.destination}" />
							<h:outputText
								value="#{messages.actionExtraction_destination_help}" />
						</h:panelGrid>
					</ui:repeat>

					<h:panelGrid columns="3" columnClasses="caption,value,help">
						<h:outputText value="" />
						<h:commandLink
							action="#{projectDetail.addExtraction(actionExtraction)}">
							<h:graphicImage value="/images/elementary/add.png"
								styleClass="linkimage" />
							<h:outputText value="#{messages.actionExtraction_add_extraction}"
								styleClass="linktext" />
						</h:commandLink>
						<h:outputText value="" />
					</h:panelGrid>


					<h:commandButton
						action="#{projectDetail.chooseExtractionMavenArtifact(actionExtraction)}"
						value="#{messages.add_mavenartifact}"
						rendered="#{empty actionExtraction.mavenArtifact and empty actionExtraction.spacerUrl}" />
					<h:commandButton
						action="#{projectDetail.chooseExtractionSpacerUrl(actionExtraction)}"
						value="#{messages.add_spacerurl}"
						rendered="#{empty actionExtraction.mavenArtifact and empty actionExtraction.spacerUrl}" />

					<h:commandLink
						action="#{projectDetail.deleteMavenArtifact(actionExtraction.mavenArtifact)}"
						class="deletionlink"
						rendered="#{not empty actionExtraction.mavenArtifact}"
						title="#{messages.mavenArtifact_delete}">
						<h:graphicImage value="/images/elementary/edit-delete.png" />
					</h:commandLink>
					<h:commandLink
						action="#{projectDetail.deleteSpacerUrl(actionExtraction.spacerUrl)}"
						class="deletionlink"
						rendered="#{not empty actionExtraction.spacerUrl}"
						title="#{messages.spacerUrl_delete}">
						<h:graphicImage value="/images/elementary/edit-delete.png" />
					</h:commandLink>
					<ui:include src="/layout/mavenArtifact_or_spacerUrl.xhtml">
						<ui:param name="actionEntity" value="#{actionExtraction}" />
						<ui:param name="idPrefix" value="actionExtraction_" />
					</ui:include>

				</rich:panel>
			</ui:repeat>
			<h:commandButton action="#{projectDetail.chooseExtraction}"
				value="#{messages.actionExtraction_add}" />
		</rich:tab>
		<rich:tab
			header="#{messages.actionCheckouts} (#{projectDetail.instance.actionCheckouts.size()})">
			<h:commandButton action="#{projectDetail.chooseCheckout}"
				value="#{messages.actionCheckout_add}"
				rendered="#{empty projectDetail.instance.actionCheckouts}" />

			<ui:repeat var="actionCheckout"
				value="#{projectDetail.instance.actionCheckouts}">
				<rich:panel header="#{messages.actionCheckout}">
					<h:commandLink
						action="#{projectDetail.deleteActionCheckout(actionCheckout)}"
						class="deletionlink" title="#{messages.actionCheckout_delete}">
						<h:graphicImage value="/images/elementary/edit-delete.png" />
					</h:commandLink>

					<h:panelGrid columns="3" columnClasses="caption,value,help">
						<h:outputText value="#{messages.actionCheckout_source}" />
						<h:outputText
							value="#{projectDetail.instance.vcsHost.uri}#{projectDetail.instance.vcsPath}" />
						<h:outputText value="#{messages.actionCheckout_source_help}" />

						<h:outputText value="#{messages.actionCheckout_targetPath}" />
						<h:inputText value="#{actionCheckout.targetPath}" />
						<h:outputText value="#{messages.actionCheckout_targetPath_help}" />
					</h:panelGrid>
				</rich:panel>
			</ui:repeat>
		</rich:tab>
		<rich:tab
			header="#{messages.actionReplacements} (#{projectDetail.instance.actionReplacements.size()})">
			<ui:include src="/layout/actionReplacement.xhtml">
				<ui:param name="entityDetail" value="#{projectDetail}" />
			</ui:include>
		</rich:tab>
	</rich:tabPanel>


	<h:commandButton value="#{messages.save}"
		action="#{projectDetail.save}" />

</ui:composition>