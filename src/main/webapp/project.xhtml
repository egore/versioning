<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="layout/core.xhtml">

	<ui:define name="title">
		<h:outputText value="#{messages.project}" />
	</ui:define>

	<rich:panel header="#{messages.project}">
		<h:panelGrid columns="2" columnClasses="caption,">
			<h:outputText value="#{messages.project_name}" />
			<h:inputText value="#{projectDetail.instance.name}" id="project_name" />

			<h:outputText value="#{messages.project_description}" />
			<h:inputText value="#{projectDetail.instance.description}"
				id="project_description" />

			<h:outputText value="#{messages.project_vcsHost}" />
			<h:selectOneMenu value="#{projectDetail.instance.vcsHost}"
				id="project_vcsHost" converter="vcshostConverter">
				<f:selectItems value="#{projectDetail.vcshostSelectItems}" />
			</h:selectOneMenu>

			<h:outputText value="#{messages.project_vcsPath}" />
			<h:inputText value="#{projectDetail.instance.vcsPath}"
				id="project_vcsPath" disabled="#{projectDetail.managed}" />

			<h:outputText value="#{messages.project_mavenRepository}" />
			<h:selectOneMenu value="#{projectDetail.instance.mavenRepository}"
				id="project_mavenRepository" converter="mavenrepositoryConverter">
				<f:selectItems
					value="#{projectDetail.allMavenRepositoriesSelectItems}" />
			</h:selectOneMenu>

			<h:outputText value="#{messages.project_tagTransformer}" />
			<h:selectOneMenu value="#{projectDetail.instance.tagTransformer}"
				id="project_tagTransformer" converter="tagtransformerConverter">
				<f:selectItem itemValue="#{null}"
					itemLabel="#{messages.tagtransformer_none}" />
				<f:selectItems value="#{projectDetail.allTagTransformerSelectItems}" />
			</h:selectOneMenu>

			<h:outputText value="#{messages.project_configuredServers}" />
			<h:selectManyMenu value="#{projectDetail.instance.configuredServers}"
				id="project_configuredServers" converter="serverConverter">
				<f:selectItems value="#{projectDetail.allServerSelectItems}" />
				<!-- JSF 2 creates a clone of a completely valid PersistentBag making it lose it's entitymanager, see http://stackoverflow.com/questions/5610908/selectmanycheckbox-lazyinitializationexception-on-process-validation -->
				<f:attribute name="collectionType" value="java.util.ArrayList" />
			</h:selectManyMenu>
		</h:panelGrid>
	</rich:panel>

	<!-- "Add action" buttons -->
	<h:commandButton action="#{projectDetail.chooseCopy}"
		value="#{messages.project_add_copy}"
		rendered="#{empty projectDetail.instance.actionCopy}" />
	<h:commandButton action="#{projectDetail.chooseExtraction}"
		value="#{messages.project_add_extraction}"
		rendered="#{empty projectDetail.instance.actionExtraction}" />

	<rich:panel header="#{messages.actionCopy}"
		rendered="#{not empty projectDetail.instance.actionCopy}">

		<h:panelGrid columns="2" columnClasses="caption,">
			<h:outputText value="#{messages.actionCopy_targetPath}" />
			<h:inputText value="#{projectDetail.instance.actionCopy.targetPath}"
				id="actionCopy_targetPath" />
		</h:panelGrid>

		<h:commandButton action="#{projectDetail.chooseCopyMavenArtifact}"
			value="#{messages.add_mavenartifact}"
			rendered="#{empty projectDetail.instance.actionCopy.mavenArtifact and empty projectDetail.instance.actionCopy.spacerUrl}" />
		<h:commandButton action="#{projectDetail.chooseCopySpacerUrl}"
			value="#{messages.add_spacerurl}"
			rendered="#{empty projectDetail.instance.actionCopy.mavenArtifact and empty projectDetail.instance.actionCopy.spacerUrl}" />

		<ui:include src="/layout/mavenArtifact_or_spacerUrl.xhtml">
			<ui:param name="actionEntity"
				value="#{projectDetail.instance.actionCopy}" />
			<ui:param name="idPrefix" value="actionCopy_" />
		</ui:include>

	</rich:panel>

	<rich:panel header="#{messages.actionExtraction}"
		rendered="#{not empty projectDetail.instance.actionExtraction}">

		<ui:repeat
			value="#{projectDetail.instance.actionExtraction.extractions}"
			var="extraction">
			<h:panelGrid columns="2" columnClasses="caption,">
				<h:outputText value="#{messages.actionExtraction_source}" />
				<h:inputText value="#{extraction.source}" />
				<h:outputText value="#{messages.actionExtraction_destination}" />
				<h:inputText value="#{extraction.destination}" />
			</h:panelGrid>
		</ui:repeat>
		<h:commandButton value="#{messages.actionExtraction_add_extraction}"
			action="#{projectDetail.addExtraction}" />


		<h:commandButton
			action="#{projectDetail.chooseExtractionMavenArtifact}"
			value="#{messages.add_mavenartifact}"
			rendered="#{empty projectDetail.instance.actionExtraction.mavenArtifact and empty projectDetail.instance.actionExtraction.spacerUrl}" />
		<h:commandButton action="#{projectDetail.chooseExtractionSpacerUrl}"
			value="#{messages.add_spacerurl}"
			rendered="#{empty projectDetail.instance.actionExtraction.mavenArtifact and empty projectDetail.instance.actionExtraction.spacerUrl}" />

		<ui:include src="/layout/mavenArtifact_or_spacerUrl.xhtml">
			<ui:param name="actionEntity"
				value="#{projectDetail.instance.actionExtraction}" />
			<ui:param name="idPrefix" value="actionExtraction_" />
		</ui:include>
	</rich:panel>


	<h:commandButton value="#{messages.save}"
		action="#{projectDetail.save}" />

</ui:composition>